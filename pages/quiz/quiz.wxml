<!--pages/quiz/quiz.wxml - é—¯å…³ç­”é¢˜-->
<block wx:if="{{isRegistered}}">
  <view class="container">
    <!-- å…³å¡é€‰æ‹©å™¨ (æ˜¾ç¤ºè¿›åº¦) -->
    <view class="level-selector">
      <view 
        wx:for="{{levels}}" 
        wx:key="id"
        wx:for-index="idx"
        class="level-btn {{currentLevelIndex === idx ? 'level-active' : ''}} {{idx < currentLevelIndex ? 'level-done' : ''}}"
      >
        <text wx:if="{{idx < currentLevelIndex}}">âœ“</text>
        <text wx:else>{{idx + 1}}</text>
        <text class="level-label">{{item.label}}</text>
      </view>
    </view>

    <!-- Loading çŠ¶æ€ -->
    <view wx:if="{{isLoading}}" class="empty-state">
      <view class="loading-spinner"></view>
      <text class="empty-text">{{loadingTip}}</text>
    </view>

    <!-- æ— é¢˜ç›®çŠ¶æ€ -->
    <view wx:elif="{{currentQuestions.length === 0}}" class="empty-state">
      <text class="empty-emoji">ğŸ”’</text>
      <text class="empty-text">è¯¥å…³å¡è¿˜åœ¨å‡†å¤‡ä¸­...</text>
    </view>

    <!-- ç­”é¢˜åŒºåŸŸ -->
    <view wx:else class="quiz-area">
      <!-- è¿›åº¦æ¡ -->
      <view class="progress-bar-container">
        <view class="progress-bar-bg">
          <view 
            class="progress-bar-fill" 
            style="width: {{((currentQIndex + 1) / currentQuestions.length) * 100}}%"
          ></view>
        </view>
      </view>

      <!-- é¢˜ç›®å¡ç‰‡ -->
      <view class="question-card">
        <view class="question-bg-icon">
          <image src="/assets/icons/brain.svg" mode="aspectFit" class="question-icon-img"/>
        </view>
        <text class="question-text">{{currentQuestion.question}}</text>
      </view>

      <!-- é€‰é¡¹åˆ—è¡¨ -->
      <view class="options-list">
        <view 
          wx:for="{{currentQuestion.options}}" 
          wx:key="index"
          class="option-btn {{selectedOption === null ? 'option-default' : (index === currentQuestion.correctIndex ? 'option-correct' : (index === selectedOption ? 'option-wrong' : 'option-disabled'))}}"
          bindtap="selectOption"
          data-index="{{index}}"
        >
          <text class="option-text">{{item}}</text>
          <image 
            wx:if="{{selectedOption !== null && index === currentQuestion.correctIndex}}"
            src="/assets/icons/check-circle.svg" 
            class="option-icon correct"
            mode="aspectFit"
          />
          <image 
            wx:if="{{selectedOption !== null && index === selectedOption && index !== currentQuestion.correctIndex}}"
            src="/assets/icons/x-circle.svg" 
            class="option-icon wrong"
            mode="aspectFit"
          />
          <view 
            wx:if="{{selectedOption === null}}"
            class="option-circle"
          ></view>
        </view>
      </view>

      <!-- è§£é‡Šå¼¹çª— -->
      <view wx:if="{{showExplanation}}" class="explanation-panel animate-pop">
        <view class="explanation-header">
          <text class="result-emoji {{isCorrect ? 'bounce' : ''}}">{{isCorrect ? 'ğŸ‰' : 'ğŸ˜…'}}</text>
          <text class="result-title">{{isCorrect ? 'ç­”å¯¹å•¦ï¼' : 'å“å‘€ï¼Œç­”é”™äº†'}}</text>
        </view>
        <view class="explanation-content">
          <text class="explanation-text">ğŸ’¡ {{currentQuestion.explanation}}</text>
        </view>
        <!-- å°† button æ”¹ä¸º view å¢åŠ ç‚¹å‡»å“åº”å¯é æ€§ -->
        <view class="btn btn-dark next-btn" bindtap="handleNext">
          <text>{{currentQIndex < currentQuestions.length - 1 ? 'ä¸‹ä¸€é¢˜ â†’' : (currentLevelIndex < levels.length - 1 ? 'ä¸‹ä¸€å…³ â†’' : 'é¢†å–å¥–åŠ± ğŸ')}}</text>
        </view>
      </view>
    </view>
  </view>
</block>

<view wx:else class="auth-loading-placeholder">
  <view class="loading-spinner"></view>
</view>
