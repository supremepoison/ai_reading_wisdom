<!--pages/notes/notes.wxml - è¯»åæ„Ÿç”Ÿæˆ-->
<block wx:if="{{isRegistered}}">
  <view class="container">
    <!-- åŠ è½½é—®é¢˜ä¸­ -->
    <view wx:if="{{step === 'loading'}}" class="generating-view">
      <view class="spinner-container">
        <view class="spinner"></view>
        <text class="spinner-emoji">ğŸ“</text>
      </view>
      <text class="generating-title">{{loadingTip}}</text>
      <text class="generating-desc">æ­£åœ¨ä¸ºã€Š{{currentBook.title}}ã€‹å‡†å¤‡ä¸“å±é—®é¢˜</text>
    </view>

    <!-- å¼•å¯¼æç¤º -->
    <view wx:if="{{step === 'input'}}" class="notes-input">
      <view class="intro-card">
        <view class="intro-icon">âœï¸</view>
        <view class="intro-content">
          <text class="intro-title">è¯»åæ„Ÿå°åŠ©æ‰‹</text>
          <text class="intro-desc">ã€Š{{currentBook.title}}ã€‹{{currentBook.currentChapter}}</text>
          <text class="intro-hint">å›ç­” 5 ä¸ªé—®é¢˜ï¼Œé­”æ³•ç”Ÿæˆï¼</text>
        </view>
      </view>

      <!-- é—®é¢˜åˆ—è¡¨ -->
      <view class="questions-list">
        <view 
          wx:for="{{questions}}" 
          wx:key="index"
          class="question-card"
        >
          <text class="question-label">{{item}}</text>
          <textarea 
            class="answer-input"
            value="{{answers[index]}}"
            bindinput="onAnswerChange"
            data-index="{{index}}"
            placeholder="æˆ‘è§‰å¾—..."
            placeholder-class="answer-placeholder"
            maxlength="500"
            auto-height
          />
        </view>
      </view>

      <!-- ç”ŸæˆæŒ‰é’® -->
      <button class="btn btn-dark generate-btn" bindtap="handleGenerate">
        <image src="/assets/icons/trophy.svg" mode="aspectFit" class="btn-icon"/>
        <text>ç”Ÿæˆè¯»åæ„Ÿ</text>
      </button>
    </view>

    <!-- ç”Ÿæˆä¸­çŠ¶æ€ -->
    <view wx:if="{{step === 'generating'}}" class="generating-view">
      <view class="spinner-container">
        <view class="spinner"></view>
        <text class="spinner-emoji">âœ¨</text>
      </view>
      <text class="generating-title">AI é­”æ³•æ–½æ³•ä¸­...</text>
      <text class="generating-desc">æ­£åœ¨æ•´ç†ä½ çš„ç²¾å½©æƒ³æ³•ï¼</text>
    </view>

    <!-- ç»“æœå±•ç¤º -->
    <view wx:if="{{step === 'result'}}" class="result-view">
      <view class="result-card">
        <view class="result-inner">
          <!-- è£…é¥°å›¾æ ‡ -->
          <view class="decorative-badge">
            <image src="/assets/icons/award.svg" mode="aspectFit"/>
          </view>

          <!-- ä¹¦ç±ä¿¡æ¯ -->
          <view class="book-header">
            <image src="{{currentBook.coverUrl || 'https://picsum.photos/id/24/100/100'}}" class="book-thumb" mode="aspectFill"/>
            <view class="book-meta">
              <text class="book-name">ã€Š{{currentBook.title}}ã€‹</text>
              <view class="date-badge">
                <text>ğŸ“… {{currentDate}}</text>
              </view>
            </view>
          </view>

          <!-- è¯»åæ„Ÿå†…å®¹ -->
          <view class="note-content">
            <text>{{generatedNote}}</text>
          </view>

          <!-- åº•éƒ¨æ ‡è¯† -->
          <view class="result-footer">
            <view class="grade-badge">
              <text>A+</text>
            </view>
            <text class="brand-text">WISDOM KEY</text>
            <text class="medal-emoji">ğŸ…</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button class="btn btn-secondary" bindtap="handleRewrite">
          <text>é‡å†™</text>
        </button>
        <button class="btn btn-primary" bindtap="handleShare">
          <image src="/assets/icons/share.svg" mode="aspectFit" class="btn-icon"/>
          <text>åˆ†äº«å¡ç‰‡</text>
        </button>
      </view>
    </view>
  </view>
</block>

<view wx:else class="auth-loading-placeholder">
  <view class="loading-spinner"></view>
</view>
